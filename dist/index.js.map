{"version":3,"file":"index.js","sources":["../src/material/blockMaterial.ts","../src/utils/values.ts","../src/rendering.ts","../src/component/object3D.ts","../src/component/block.ts","../src/component/index.ts","../src/camera.ts","../src/controls.ts","../src/utils/system.ts","../src/system/rendering.ts","../src/system/index.ts","../src/game.ts","../src/scene.ts","../src/index.ts"],"sourcesContent":["import { MeshPhongMaterial } from 'three';\n\nexport const blockMaterial = new MeshPhongMaterial({\n  color: 0xdddddd,\n  specular: 0x050505,\n  shininess: 30,\n  flatShading: true,\n});\n","export const def = <T>(...values: T[]): T =>\n  values.find((value) => typeof value !== 'undefined');\n","import { Scene, WebGLRenderer } from 'three';\n\nexport const scene = new Scene();\n\nexport const renderer = new WebGLRenderer();\nrenderer.setSize(window.innerWidth, window.innerHeight);\ndocument.body.appendChild(renderer.domElement);\n","import { Component } from 'ecsy';\nimport { Geometry, Object3D } from 'three';\n\nimport { scene } from '../rendering';\n\nexport type Object3DComponentProps<C> = Partial<Omit<C, keyof Component<any>>>;\n\nexport abstract class Object3DComponent<\n  C,\n  G extends Geometry = Geometry\n> extends Component<C> {\n  readonly isObject3D = true;\n\n  object3D: Object3D;\n  geometry: G;\n  isNew = true;\n\n  abstract createObject3D(): void;\n\n  dispose() {\n    const { object3D } = this;\n\n    object3D.parent ? object3D.parent.remove(object3D) : scene.remove(object3D);\n\n    super.dispose();\n  }\n}\n","import { BoxGeometry, Mesh } from 'three';\n\nimport { blockMaterial } from '../material/blockMaterial';\nimport { def } from '../utils/values';\nimport { Object3DComponent, Object3DComponentProps } from './object3D';\n\nexport class Block extends Object3DComponent<Block, BoxGeometry> {\n  width: number;\n  height: number;\n  depth: number;\n\n  constructor(props?: Object3DComponentProps<Block>) {\n    super(false);\n\n    this.width = def(props?.width, 20);\n    this.height = def(props?.height, 20);\n    this.depth = def(props?.depth, 20);\n  }\n\n  copy(src: this): this {\n    this.width = src.width;\n    this.height = src.height;\n    this.depth = src.depth;\n    if (!this.isNew) {\n      throw new Error(`I thought this would be NEW!`);\n    }\n\n    return this;\n  }\n\n  reset() {\n    this.width = 20;\n    this.height = 20;\n    this.depth = 20;\n  }\n\n  createObject3D() {\n    this.geometry = new BoxGeometry(this.width, this.height, this.depth);\n\n    this.object3D = new Mesh(this.geometry, blockMaterial);\n  }\n\n  updateObject3D() {\n    this.geometry.parameters.depth = this.depth;\n    this.geometry.parameters.height = this.height;\n    this.geometry.parameters.width = this.width;\n  }\n}\n","import { Component, ComponentConstructor } from 'ecsy';\n\nimport { Block } from './block';\n\nexport const allComponents: ComponentConstructor<any>[] = [Block];\n","import {\n  Mesh,\n  MeshBasicMaterial,\n  PerspectiveCamera,\n  PointLight,\n  SphereBufferGeometry,\n} from 'three';\n\nimport { scene } from './rendering';\n\nexport const camera = new PerspectiveCamera(\n  75,\n  window.innerWidth / window.innerHeight,\n  0.1,\n  10000\n);\n\nconst FRONT_LIGHT_COLOR = 0xffffff;\nconst pointLight = new PointLight(FRONT_LIGHT_COLOR, 1);\npointLight.position.x = -50;\npointLight.position.y = 50;\npointLight.position.z = 100;\npointLight.add(\n  new Mesh(\n    new SphereBufferGeometry(4, 8, 8),\n    new MeshBasicMaterial({ color: FRONT_LIGHT_COLOR })\n  )\n);\n\nconst BACK_LIGHT_COLOR = 0xefd6ff;\nconst backPointLight = new PointLight(BACK_LIGHT_COLOR, 1);\nbackPointLight.position.x = 150;\nbackPointLight.position.y = -250;\nbackPointLight.position.z = -400;\nbackPointLight.add(\n  new Mesh(\n    new SphereBufferGeometry(4, 8, 8),\n    new MeshBasicMaterial({ color: BACK_LIGHT_COLOR })\n  )\n);\n\ncamera.add(pointLight);\ncamera.add(backPointLight);\n\nscene.add(camera);\n","import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\n\nimport { camera } from './camera';\nimport { renderer } from './rendering';\n\nexport const controls = new OrbitControls(camera, renderer.domElement);\n","import { Component } from 'ecsy';\n\nimport { Object3DComponent } from '../component/object3D';\n\ntype CollectionObject3D = { [compName: string]: Object3DComponent<any> };\n\nexport const filterRenderableComponents = (comps: {\n  [compName: string]: Component<any>;\n}): CollectionObject3D => {\n  const filteredComps: CollectionObject3D = {};\n\n  for (const compName in comps) {\n    if (Object.prototype.hasOwnProperty.call(comps, compName)) {\n      const comp = comps[compName];\n      if ('isObject3D' in comp && comp['isObject3D'] === true) {\n        filteredComps[compName] = comp;\n      }\n    }\n  }\n\n  return filteredComps;\n};\n","import { Attributes, Entity, System, World } from 'ecsy';\n\nimport { camera } from '../camera';\nimport { Block } from '../component/block';\nimport { Object3DComponent } from '../component/object3D';\nimport { controls } from '../controls';\nimport { renderer, scene } from '../rendering';\nimport { filterRenderableComponents } from '../utils/system';\n\nexport class RenderingSystem extends System {\n  constructor(world: World<Entity>, attributes?: Attributes) {\n    super(world, attributes);\n\n    camera.position.z = 100;\n    controls.update();\n  }\n\n  execute(delta: number, time: number) {\n    this.queries.renderables.results.forEach((entity) => {\n      const components3D = filterRenderableComponents(entity.getComponents());\n\n      for (const compName in components3D) {\n        if (Object.prototype.hasOwnProperty.call(components3D, compName)) {\n          const comp = components3D[compName];\n          if (comp.isNew) {\n            this.addObject3D(comp);\n          }\n        }\n      }\n    });\n\n    controls.update();\n\n    renderer.render(scene, camera);\n  }\n\n  private addObject3D(comp: Object3DComponent<any>) {\n    const parent = scene;\n\n    comp.createObject3D();\n\n    scene.add(comp.object3D);\n    comp.isNew = false;\n  }\n}\n\nRenderingSystem.queries = {\n  renderables: { components: [Block] },\n};\n","import { SystemConstructor } from 'ecsy';\n\nimport { RenderingSystem } from './rendering';\n\nexport const allSystems: SystemConstructor<any>[] = [RenderingSystem];\n","import { World } from 'ecsy';\n\nimport { allComponents } from './component';\nimport { allSystems } from './system';\n\nexport const world = new World();\nwindow['world'] = world;\nallComponents.forEach((comp) => world.registerComponent(comp));\nallSystems.forEach((system) => world.registerSystem(system));\n\nlet paused = true;\nlet fpsInterval: number,\n  startTime: number,\n  now: number,\n  then: number,\n  elapsed: number,\n  timer: NodeJS.Timeout;\n\nexport function startLoop(fps: number) {\n  paused = false;\n  fpsInterval = 1000 / fps;\n  then = performance.now();\n  startTime = then;\n  timer = setInterval(() => loop(), fpsInterval);\n}\n\nexport function stopLoop() {\n  paused = true;\n  clearInterval(timer);\n}\n\nfunction loop() {\n  if (paused) {\n    return;\n  }\n\n  now = performance.now();\n  elapsed = now - then;\n\n  world.execute(elapsed, startTime);\n\n  then = performance.now();\n}\n","import { PointLight } from 'three';\n\nimport { camera } from './camera';\nimport { Block } from './component/block';\nimport { world } from './game';\nimport { scene } from './rendering';\n\nworld\n  .createEntity('Block1')\n  .addComponent<Block>(Block, { depth: 10, height: 70, width: 30 });\n","import './scene';\n\nimport { startLoop } from './game';\n\n// Loop logic\nstartLoop(60);\n\n// ---\n"],"names":["MeshPhongMaterial","Scene","WebGLRenderer","Component","BoxGeometry","Mesh","PerspectiveCamera","PointLight","SphereBufferGeometry","MeshBasicMaterial","OrbitControls","System","World"],"mappings":"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"}